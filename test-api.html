<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Generation API Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-section {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #444;
            font-weight: 600;
            font-size: 14px;
        }

        select, textarea, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        select:focus, textarea:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 150px;
        }

        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .mode-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .mode-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .mode-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .mode-option input[type="radio"] {
            display: none;
        }

        .question-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .question-type {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .question-type label {
            margin-bottom: 5px;
            font-size: 13px;
        }

        .question-type input[type="number"] {
            width: 100%;
            padding: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            margin-top: 30px;
            display: none;
        }

        .results.active {
            display: block;
        }

        .result-header {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .result-stat {
            display: inline-block;
            margin-right: 20px;
            font-size: 14px;
        }

        .result-stat strong {
            color: #667eea;
        }

        .question-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .question-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .question-number {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .options {
            list-style: none;
        }

        .option {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
        }

        .option:hover {
            background: #f8f9ff;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option.wrong {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .explanation {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .time-badge {
            display: inline-block;
            background: #ffc107;
            color: #333;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 10px;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #dc3545;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .error.active {
            display: block;
        }

        .api-url {
            background: #f8f9ff;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 12px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            color: #667eea;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéì Question Generation API Tester</h1>
        <p class="subtitle">Test the Express backend with Ollama and Gemini models</p>

        <div class="api-url">
            <strong>API Endpoint:</strong> <span id="apiUrl">http://localhost:9006</span>
            <input type="text" id="apiUrlInput" placeholder="http://localhost:9006" style="margin-top: 5px;" value="http://localhost:9006">
        </div>

        <!-- Tab Navigation -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
            <button type="button" class="tab-btn active" onclick="switchTab('transcript')">üìù Transcript Input</button>
            <button type="button" class="tab-btn" onclick="switchTab('youtube')">üé• YouTube Video</button>
        </div>

        <!-- Transcript Tab -->
        <form id="questionForm" class="tab-content active" data-tab="transcript">
            <!-- Mode Selection -->
            <div class="form-section">
                <label>Select AI Mode</label>
                <div class="mode-selector">
                    <div class="mode-option selected" onclick="selectMode('ollama')">
                        <input type="radio" name="mode" value="ollama" checked>
                        <div style="font-size: 24px; margin-bottom: 5px;">ü¶ô</div>
                        <strong>Ollama</strong>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Local models</div>
                    </div>
                    <div class="mode-option" onclick="selectMode('gemini')">
                        <input type="radio" name="mode" value="gemini">
                        <div style="font-size: 24px; margin-bottom: 5px;">‚ú®</div>
                        <strong>Gemini</strong>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Google AI</div>
                    </div>
                </div>
            </div>

            <!-- Model Selection -->
            <div class="form-section">
                <label for="model">Select Model</label>
                <select id="model" required>
                    <option value="">Loading models...</option>
                </select>
            </div>

            <!-- Transcript Input -->
            <div class="form-section">
                <label for="transcript">Lecture Transcript</label>
                <textarea id="transcript" placeholder="Paste your lecture transcript here..." required></textarea>
            </div>

            <!-- Question Types -->
            <div class="form-section">
                <label>Question Types (count for each type)</label>
                <div class="question-types">
                    <div class="question-type">
                        <label>MCQ (Multiple Choice)</label>
                        <input type="number" id="MCQ" min="0" max="10" value="2">
                    </div>
                    <div class="question-type">
                        <label>SOL (Simple One-Line)</label>
                        <input type="number" id="SOL" min="0" max="10" value="1">
                    </div>
                    <div class="question-type">
                        <label>SML (Short Multi-Line)</label>
                        <input type="number" id="SML" min="0" max="10" value="1">
                    </div>
                    <div class="question-type">
                        <label>TF (True/False)</label>
                        <input type="number" id="TF" min="0" max="10" value="0">
                    </div>
                    <div class="question-type">
                        <label>FIB (Fill in Blank)</label>
                        <input type="number" id="FIB" min="0" max="10" value="0">
                    </div>
                </div>
            </div>

            <!-- Generate Button -->
            <button type="submit" class="btn">Generate Questions</button>
        </form>

        <!-- YouTube Tab -->
        <form id="youtubeForm" class="tab-content" data-tab="youtube" style="display: none;">
            <!-- YouTube URL -->
            <div class="form-section">
                <label for="videoUrl">YouTube Video URL or ID</label>
                <input type="text" id="videoUrl" placeholder="https://www.youtube.com/watch?v=dQw4w9WgXcQ or video ID" required>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    Accepts: Full URL, short URL (youtu.be), or just the video ID
                </div>
            </div>

            <!-- Time Range -->
            <div class="form-section">
                <label>Time Range (optional)</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label for="startTime" style="font-size: 12px; color: #666;">Start Time (seconds)</label>
                        <input type="number" id="startTime" placeholder="0" min="0">
                    </div>
                    <div>
                        <label for="endTime" style="font-size: 12px; color: #666;">End Time (seconds)</label>
                        <input type="number" id="endTime" placeholder="Leave empty for full video" min="0">
                    </div>
                </div>
            </div>

            <!-- Mode Selection for YouTube -->
            <div class="form-section">
                <label>Select AI Mode (defaults to Ollama)</label>
                <div class="mode-selector">
                    <div class="mode-option selected" onclick="selectYoutubeMode('ollama')">
                        <input type="radio" name="youtubeMode" value="ollama" checked>
                        <div style="font-size: 24px; margin-bottom: 5px;">ü¶ô</div>
                        <strong>Ollama</strong>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Local models</div>
                    </div>
                    <div class="mode-option" onclick="selectYoutubeMode('gemini')">
                        <input type="radio" name="youtubeMode" value="gemini">
                        <div style="font-size: 24px; margin-bottom: 5px;">‚ú®</div>
                        <strong>Gemini</strong>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Google AI</div>
                    </div>
                </div>
            </div>

            <!-- Model Selection for YouTube -->
            <div class="form-section">
                <label for="youtubeModel">Select Model (defaults to gemma3:latest)</label>
                <input type="text" id="youtubeModel" placeholder="gemma3:latest" value="gemma3:latest">
            </div>

            <!-- Question Types for YouTube -->
            <div class="form-section">
                <label>Question Types (defaults to 3 MCQ)</label>
                <div class="question-types">
                    <div class="question-type">
                        <label>MCQ (Multiple Choice)</label>
                        <input type="number" id="youtubeMCQ" min="0" max="10" value="3">
                    </div>
                    <div class="question-type">
                        <label>SOL (Simple One-Line)</label>
                        <input type="number" id="youtubeSOL" min="0" max="10" value="0">
                    </div>
                    <div class="question-type">
                        <label>SML (Short Multi-Line)</label>
                        <input type="number" id="youtubeSML" min="0" max="10" value="0">
                    </div>
                    <div class="question-type">
                        <label>TF (True/False)</label>
                        <input type="number" id="youtubeTF" min="0" max="10" value="0">
                    </div>
                    <div class="question-type">
                        <label>FIB (Fill in Blank)</label>
                        <input type="number" id="youtubeFIB" min="0" max="10" value="0">
                    </div>
                </div>
            </div>

            <!-- Generate Button -->
            <button type="submit" class="btn">üé• Transcribe & Generate Questions</button>
        </form>

        <!-- Loading State -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Generating questions... This may take a few moments.</p>
        </div>

        <!-- Error Message -->
        <div class="error" id="error"></div>

        <!-- Results -->
        <div class="results" id="results">
            <div class="result-header" id="resultHeader"></div>
            <div id="questionsList"></div>
        </div>
    </div>

    <script>
        let currentMode = 'ollama';
        let currentYoutubeMode = 'ollama';
        let apiBaseUrl = 'http://localhost:9006';

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeTab) {
                activeTab.style.display = 'block';
                activeTab.classList.add('active');
            }
        }

        // Update API URL
        document.getElementById('apiUrlInput').addEventListener('change', (e) => {
            apiBaseUrl = e.target.value;
            document.getElementById('apiUrl').textContent = apiBaseUrl;
        });

        // Mode selection for transcript tab
        function selectMode(mode) {
            currentMode = mode;
            const parent = event.target.closest('.mode-selector');
            parent.querySelectorAll('.mode-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.closest('.mode-option').classList.add('selected');
            parent.querySelector(`input[value="${mode}"]`).checked = true;
            loadModels();
        }

        // Mode selection for YouTube tab
        function selectYoutubeMode(mode) {
            currentYoutubeMode = mode;
            const parent = event.target.closest('.mode-selector');
            parent.querySelectorAll('.mode-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.closest('.mode-option').classList.add('selected');
            parent.querySelector(`input[value="${mode}"]`).checked = true;
        }

        // Load models based on selected mode
        async function loadModels() {
            const modelSelect = document.getElementById('model');
            modelSelect.innerHTML = '<option value="">Loading models...</option>';
            
            try {
                const response = await fetch(`${apiBaseUrl}/api/models/${currentMode}`);
                const data = await response.json();
                
                modelSelect.innerHTML = '<option value="">Select a model...</option>';
                data.models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
                
                if (data.models.length > 0) {
                    modelSelect.selectedIndex = 1;
                }
            } catch (error) {
                modelSelect.innerHTML = '<option value="">Failed to load models</option>';
                console.error('Error loading models:', error);
            }
        }

        // Handle form submission
        document.getElementById('questionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Gather form data
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const model = document.getElementById('model').value;
            const transcript = document.getElementById('transcript').value;
            
            const questionTypes = {};
            ['MCQ', 'SOL', 'SML', 'TF', 'FIB'].forEach(type => {
                const count = parseInt(document.getElementById(type).value) || 0;
                if (count > 0) {
                    questionTypes[type] = count;
                }
            });

            if (Object.keys(questionTypes).length === 0) {
                showError('Please select at least one question type with a count greater than 0');
                return;
            }

            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').classList.remove('active');
            document.getElementById('error').classList.remove('active');
            document.querySelector('.btn').disabled = true;

            try {
                const response = await fetch(`${apiBaseUrl}/api/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        mode,
                        model,
                        transcript,
                        questionTypes
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to generate questions');
                }

                const data = await response.json();
                displayResults(data);
            } catch (error) {
                showError(`Error: ${error.message}`);
            } finally {
                document.getElementById('loading').classList.remove('active');
                document.querySelector('.btn').disabled = false;
            }
        });

        // Display results
        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            const headerDiv = document.getElementById('resultHeader');
            const questionsDiv = document.getElementById('questionsList');

            // Header with stats
            headerDiv.innerHTML = `
                <div class="result-stat"><strong>Mode:</strong> ${data.mode}</div>
                <div class="result-stat"><strong>Model:</strong> ${data.model}</div>
                <div class="result-stat"><strong>Questions:</strong> ${data.questions.length}</div>
                <div class="result-stat"><strong>Total Time:</strong> ${data.totalTime.toFixed(2)}s</div>
                <div class="result-stat"><strong>Log ID:</strong> ${data.logId}</div>
            `;

            // Questions list
            questionsDiv.innerHTML = '';
            data.questions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                
                let optionsHtml = '';
                if (q.options && q.options.length > 0) {
                    optionsHtml = '<ul class="options">';
                    q.options.forEach(opt => {
                        const className = opt.correct ? 'correct' : 'wrong';
                        optionsHtml += `
                            <li class="option ${className}">
                                <strong>${opt.text}</strong>
                                ${opt.explanation ? `<div class="explanation">${opt.explanation}</div>` : ''}
                            </li>
                        `;
                    });
                    optionsHtml += '</ul>';
                }

                card.innerHTML = `
                    <span class="question-number">Question ${index + 1} - ${q.questionType}</span>
                    <span class="time-badge">${q.timeTaken.toFixed(2)}s</span>
                    <div class="question-text">${q.questionText}</div>
                    ${optionsHtml}
                    ${q.solution ? `<div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 5px;"><strong>Solution:</strong> ${q.solution}</div>` : ''}
                `;
                
                questionsDiv.appendChild(card);
            });

            resultsDiv.classList.add('active');
        }

        // Show error
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
        }

        // Load models on page load
        loadModels();

        // Add sample transcript
        const sampleTranscript = `The nervous system is one of the most complex systems in the human body. In 1871, Joseph von Gerlach proposed the reticular theory, which suggested that the nervous system was a single continuous network. However, this theory was later challenged by the neuron doctrine, proposed by Santiago Ram√≥n y Cajal in 1891. The neuron doctrine stated that the nervous system is made up of discrete individual cells called neurons. This groundbreaking theory revolutionized our understanding of the brain and nervous system, and Cajal was awarded the Nobel Prize in Physiology or Medicine in 1906 for his work.`;

        // Handle YouTube form submission
        document.getElementById('youtubeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Gather form data
            const videoUrl = document.getElementById('videoUrl').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const mode = document.querySelector('input[name="youtubeMode"]:checked').value;
            const model = document.getElementById('youtubeModel').value || 'gemma:latest';
            
            const questionTypes = {};
            ['youtubeMCQ', 'youtubeSOL', 'youtubeSML', 'youtubeTF', 'youtubeFIB'].forEach(id => {
                const type = id.replace('youtube', '');
                const count = parseInt(document.getElementById(id).value) || 0;
                if (count > 0) {
                    questionTypes[type] = count;
                }
            });

            // Build request body
            const requestBody = { videoUrl };
            if (startTime) requestBody.startTime = parseInt(startTime);
            if (endTime) requestBody.endTime = parseInt(endTime);
            if (mode) requestBody.mode = mode;
            if (model) requestBody.model = model;
            if (Object.keys(questionTypes).length > 0) {
                requestBody.questionTypes = questionTypes;
            }

            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').classList.remove('active');
            document.getElementById('error').classList.remove('active');
            const submitBtn = document.querySelector('#youtubeForm .btn');
            submitBtn.disabled = true;

            try {
                const response = await fetch(`${apiBaseUrl}/api/transcribe-and-generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to transcribe and generate questions');
                }

                const data = await response.json();
                displayResults(data);
            } catch (error) {
                showError(`Error: ${error.message}`);
            } finally {
                document.getElementById('loading').classList.remove('active');
                submitBtn.disabled = false;
            }
        });

        // Add a button to load sample
        const transcriptArea = document.getElementById('transcript');
        if (!transcriptArea.value) {
            transcriptArea.placeholder = "Paste your lecture transcript here... (or use the sample button below)";
            const sampleBtn = document.createElement('button');
            sampleBtn.type = 'button';
            sampleBtn.textContent = 'Load Sample Transcript';
            sampleBtn.className = 'btn';
            sampleBtn.style.marginTop = '10px';
            sampleBtn.style.background = '#6c757d';
            sampleBtn.onclick = () => {
                transcriptArea.value = sampleTranscript;
                sampleBtn.remove();
            };
            transcriptArea.parentNode.appendChild(sampleBtn);
        }
    </script>
</body>
</html>
